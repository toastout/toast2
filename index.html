<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ’ƒ RP ê¸€ì“°ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
      background: #fff;
      color: #222;
      transition: background 0.3s, color 0.3s;
      user-select: text;
    }
    body.dark {
      background: #121212;
      color: #ddd;
    }

    h3 {
      margin-top: 30px;
      margin-bottom: 10px;
    }

    .columns {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .column {
      flex: 1 1 45%;
      min-width: 300px;
      display: flex;
      flex-direction: column;
    }
    textarea {
      flex: 1 1 auto;
      min-height: 180px;
      font-size: 16px;
      line-height: 1.4;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
      background: #fff;
      color: #222;
      resize: vertical;
      font-family: 'ë§‘ì€ ê³ ë”•', 'Malgun Gothic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      white-space: pre-wrap;
      overflow-wrap: break-word;
    }
    body.dark textarea {
      background: #1e1e1e;
      border-color: #555;
      color: #eee;
    }

    .copy-btn {
      margin-top: 6px;
      align-self: flex-end;
      background: #1976d2;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      user-select: none;
      transition: background-color 0.3s;
    }
    .copy-btn:hover {
      background: #135ba1;
    }

    /* ë¯¸ë¦¬ë³´ê¸° ë°•ìŠ¤ */
    .preview {
      min-height: 120px;
      border: 1px solid #ccc;
      padding: 12px;
      white-space: pre-wrap;
      background: #fafafa;
      font-size: 16px;
      line-height: 1.5;
      border-radius: 4px;
      overflow-wrap: break-word;
    }
    body.dark .preview {
      background: #252525;
      border-color: #444;
      color: #eee;
    }

    /* ê¸°í˜¸ ë²„íŠ¼ ëª¨ìŒ */
    .symbol-box {
      margin-top: 10px;
      margin-bottom: 15px;
    }
    .symbol-box button {
      margin: 3px 4px 3px 0;
      font-size: 18px;
      padding: 3px 9px;
      cursor: pointer;
      border-radius: 4px;
      border: 1.5px solid #888;
      background: #fafafa;
      transition: background-color 0.2s;
      user-select: none;
    }
    .symbol-box button:hover {
      background: #d0e2ff;
    }
    body.dark .symbol-box button {
      background: #2b2b2b;
      border-color: #666;
      color: #ddd;
    }
    body.dark .symbol-box button:hover {
      background: #3a4a8f;
    }

    /* ê°•ì¡°, í•˜ì´ë¼ì´íŒ… ìƒ‰ìƒ */
    .quote {
      color: #2a58ff; /* íŒŒë€ ëŒ€ì‚¬ */
      background-color: #dbe5ff;
      padding: 0 3px;
      border-radius: 3px;
    }
    body.dark .quote {
      background-color: #2247b1;
      color: #a5c6ff;
    }

    .thought {
      color: #2e7d32; /* ì´ˆë¡ ìƒê° */
      background-color: #d8f1d8;
      padding: 0 3px;
      border-radius: 3px;
    }
    body.dark .thought {
      background-color: #2a4b2a;
      color: #b7e1b7;
    }

    .desc {
      color: #666666; /* íšŒìƒ‰ ë¬˜ì‚¬ */
      font-style: italic;
      background-color: #f0f0f0;
      padding: 0 3px;
      border-radius: 3px;
    }
    body.dark .desc {
      background-color: #3a3a3a;
      color: #bbb;
    }

    .bold {
      font-weight: 700;
      background-color: #fff5b1;
      padding: 0 3px;
      border-radius: 3px;
      color: #6a4800;
    }
    body.dark .bold {
      background-color: #9e7f1d;
      color: #fffaf0;
    }

    .strike {
      text-decoration: line-through;
      color: #a00;
      background-color: #ffe0e0;
      padding: 0 3px;
      border-radius: 3px;
    }
    body.dark .strike {
      background-color: #731212;
      color: #ff8f8f;
    }

    .memo {
      font-size: 0.85em;
      color: #666;
      background-color: #f9f9f9;
      padding: 2px 5px;
      border-radius: 3px;
      font-family: monospace;
      user-select: none;
    }
    body.dark .memo {
      background-color: #2c2c2c;
      color: #999;
    }

    /* ë²„ì „ ì„ íƒì°½ + ì‚­ì œ ë²„íŠ¼ */
    .version-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 2px;
      font-size: 14px;
      user-select: none;
    }
    body.dark .version-item {
      border-color: #444;
    }
    .version-item button {
      background: #e57373;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: 700;
      border-radius: 3px;
      padding: 1px 6px;
      font-size: 13px;
      transition: background-color 0.3s;
    }
    .version-item button:hover {
      background: #b94545;
    }

    /* ë„ì›€ë§ ëª¨ë‹¬ */
    #overlay {
      position: fixed;
      display: none;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 1000;
    }
    #helpModal {
      display: none;
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #fff;
      color: #222;
      max-width: 360px;
      width: 90%;
      padding: 20px 25px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
      z-index: 1001;
      font-size: 15px;
    }
    body.dark #helpModal {
      background: #222;
      color: #ddd;
      box-shadow: 0 0 15px rgba(80,80,80,0.8);
    }
    .modal-close {
      position: absolute;
      top: 7px; right: 12px;
      cursor: pointer;
      font-weight: 900;
      font-size: 18px;
      user-select: none;
      color: #888;
      transition: color 0.3s;
    }
    .modal-close:hover {
      color: #222;
    }
    body.dark .modal-close:hover {
      color: #ddd;
    }
  </style>
</head>
<body>
  <h1>ğŸ’ƒ RP ê¸€ì“°ê¸°</h1>

  <div class="columns">
    <div class="column">
      <h3>ğŸŒŸ ì°¸ê³  ê¸€ - {{char}} ëŒ€ì‚¬</h3>
      <textarea id="refText" placeholder="ì°¸ê³ í•  ë‚´ìš©ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
      <button class="copy-btn" onclick="copyText('refText')">ë³µì‚¬</button>
    </div>
    <div class="column">
      <h3>ğŸ”¥ ë‚´ ê¸€ ì‘ì„± - {{user}} ëŒ€ì‚¬</h3>
      <textarea id="myText" placeholder="ì—¬ê¸°ì— ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”."></textarea>
      <button class="copy-btn" onclick="copyText('myText')">ë³µì‚¬</button>

      <div class="symbol-box" aria-label="ê¸°í˜¸ ì‚½ì…">
        <strong>ê¸°í˜¸ ì‚½ì…:</strong><br />
        <button onclick="insertSymbol('â€œ')" aria-label='ì‚½ì… "â€œ"'>â€œ</button>
        <button onclick="insertSymbol('â€')" aria-label='ì‚½ì… "â€"'>â€</button>
        <button onclick="insertSymbol('\'')" aria-label="ì‚½ì… '''">'</button>
        <button onclick="insertSymbol('*')" aria-label="ì‚½ì… *">*</button>
        <button onclick="insertSymbol('_')" aria-label="ì‚½ì… _">_</button>
        <button onclick="insertSymbol('~')" aria-label="ì‚½ì… ~">~</button>
        <button onclick="insertSymbol('/')" aria-label="ì‚½ì… /">/</button>
      </div>

      <div class="controls" aria-label="ë²„ì „ ë° ê¸°íƒ€ ì¡°ì‘ ë²„íŠ¼">
        <button onclick="saveVersion()">ğŸ’¾ ì €ì¥</button>
        <button onclick="clearText()">ğŸ§¹ ì´ˆê¸°í™”</button>
        <button onclick="downloadText()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
        <button onclick="toggleDark()">ğŸŒ— ë‹¤í¬ëª¨ë“œ</button>
        <button onclick="openHelp()">â” ë„ì›€ë§</button>
      </div>

      <div id="versionListContainer" aria-label="ì´ì „ ë²„ì „ ëª©ë¡" style="margin-top:10px;">
        <strong>ì´ì „ ë²„ì „:</strong>
        <div id="versionList" style="max-height: 160px; overflow-y: auto; border: 1px solid #ccc; padding: 6px; border-radius: 4px;">
          <!-- ë²„ì „ ì•„ì´í…œ ë™ì  ì¶”ê°€ -->
        </div>
      </div>

      <div class="count-info" id="stats" aria-live="polite" style="margin-top: 8px; font-weight: 600;"></div>
    </div>
  </div>

  <h3>ğŸ’­ï¸ ë‚´ ê¸€ ë¯¸ë¦¬ë³´ê¸° (ì‹¤ì‹œê°„)</h3>
  <div class="preview" id="previewBox" aria-live="polite"></div>

  <!-- ë„ì›€ë§ ëª¨ë‹¬ -->
  <div id="overlay" onclick="closeHelp()"></div>
  <div id="helpModal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" aria-describedby="helpDesc">
    <div class="modal-close" onclick="closeHelp()" aria-label="ë‹«ê¸°">Ã—</div>
    <h2 id="helpTitle">ê¸°í˜¸ ì‚¬ìš©ë²•</h2>
    <div id="helpDesc">
      <p><strong>ê¸°í˜¸ë³„ ì—­í•  ì•ˆë‚´</strong></p>
      <ul>
        <li><code>â€œ</code> : ëŒ€ì‚¬ ì‹œì‘ (íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŒ…)</li>
        <li><code>â€</code> : ëŒ€ì‚¬ ë (íŒŒë€ìƒ‰ í•˜ì´ë¼ì´íŒ…)</li>
        <li><code>'</code> : ìƒê° í‘œí˜„ (ì´ˆë¡ìƒ‰)</li>
        <li><code>*</code> : ë¬˜ì‚¬ ê°•ì¡° (íšŒìƒ‰, ì´íƒ¤ë¦­)</li>
        <li><code>_</code> : ë©”ëª¨ ìŠ¤íƒ€ì¼ (ì‘ì€ ê¸€ì”¨, íšŒìƒ‰ ë°°ê²½)</li>
        <li><code>~</code> : ì‚­ì œì„  ìŠ¤íƒ€ì¼</li>
        <li><code>/</code> : êµµì€ ê°•ì¡°</li>
      </ul>
      <p>íŠ¹ìˆ˜ë¬¸ì <code>â€˜ â€™</code>ëŠ” ëª¨ë‘ <code>'</code>ë¡œ ìë™ ë³€í™˜ë©ë‹ˆë‹¤.</p>
      <p>ë²„ì „ ì €ì¥ í›„, ì €ì¥ ëª©ë¡ì—ì„œ ì´ì „ ë²„ì „ì„ í´ë¦­í•´ ë¶ˆëŸ¬ì˜¤ê±°ë‚˜ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </div>
  </div>

  <script>
    const refText = document.getElementById('refText');
    const myText = document.getElementById('myText');
    const previewBox = document.getElementById('previewBox');
    const versionList = document.getElementById('versionList');

    // ë‹¤í¬ëª¨ë“œ ìƒíƒœ ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°
    function toggleDark() {
      document.body.classList.toggle('dark');
      localStorage.setItem('rp_darkmode', document.body.classList.contains('dark'));
    }
    // í˜ì´ì§€ ë¡œë“œì‹œ ë‹¤í¬ëª¨ë“œ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
    if(localStorage.getItem('rp_darkmode') === 'true') {
      document.body.classList.add('dark');
    }

    // íŠ¹ìˆ˜ë¬¸ì ì‚½ì…
    function insertSymbol(sym) {
      const el = myText;
      const start = el.selectionStart;
      const end = el.selectionEnd;
      const val = el.value;
      el.value = val.substring(0, start) + sym + val.substring(end);
      el.selectionStart = el.selectionEnd = start + sym.length;
      el.focus();
      updatePreview();
      updateStats();
    }

    // ë³µì‚¬ í•¨ìˆ˜
    function copyText(id) {
      const el = document.getElementById(id);
      const text = el.value;
      navigator.clipboard.writeText(text).then(() => {
        alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
      }).catch(() => {
        alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
      });
    }

    // ì°¸ê³  ê¸€ í•˜ì´ë¼ì´íŠ¸ ì ìš© í•¨ìˆ˜
    function highlightText(text) {
      if (!text) return '';

      // 'â€˜' ì™€ 'â€™'ë¥¼ ëª¨ë‘ ' ë‹¨ì¼ ì¸ìš©ë¶€í˜¸ë¡œ í†µí•©
      text = text.replace(/[â€˜â€™]/g, "'");

      // Markdown ìŠ¤íƒ€ì¼ (ê°•ì¡°, ì‚­ì œì„  ë“±)
      text = text.replace(/__(.*?)__/g, '<span class="bold">$1</span>');
      text = text.replace(/~~(.*?)~~/g, '<span class="strike">$1</span>');
      text = text.replace(/_(.*?)_/g, '<span class="memo">$1</span>');

      // ê¸°í˜¸ë³„ í•˜ì´ë¼ì´íŠ¸
      // â€œ â€ (ëŒ€ì‚¬) - íŒŒë€ìƒ‰
      text = text.replace(/â€œ(.*?)â€/g, '<span class="quote">â€œ$1â€</span>');
      // ' (ìƒê°) - ì´ˆë¡ìƒ‰
      text = text.replace(/'(.*?)'/g, '<span class="thought">\'$1\'</span>');
      // * (ë¬˜ì‚¬) - íšŒìƒ‰, ì´íƒ¤ë¦­
      text = text.replace(/\*(.*?)\*/g, '<span class="desc">*$1*</span>');

      return text;
    }

    // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
    function updatePreview() {
      let rawText = myText.value;
      rawText = rawText.replace(/[â€˜â€™]/g, "'"); // â€˜ â€™ â†’ '

      // Markdown ìŠ¤íƒ€ì¼ (ê°•ì¡°, ì‚­ì œì„  ë“±)
      let html = rawText;
      html = html.replace(/__(.*?)__/g, '<span class="bold">$1</span>');
      html = html.replace(/~~(.*?)~~/g, '<span class="strike">$1</span>');
      html = html.replace(/_(.*?)_/g, '<span class="memo">$1</span>');

      // ê¸°í˜¸ë³„ í•˜ì´ë¼ì´íŠ¸
      html = html.replace(/â€œ(.*?)â€/g, '<span class="quote">â€œ$1â€</span>');
      html = html.replace(/'(.*?)'/g, '<span class="thought">\'$1\'</span>');
      html = html.replace(/\*(.*?)\*/g, '<span class="desc">*$1*</span>');

      // ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜
      html = html.replace(/\n/g, '<br>');

      previewBox.innerHTML = html;
    }

    // ì°¸ê³  ê¸€ì—ë„ ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŠ¸ ì ìš©
    refText.addEventListener('input', () => {
      const highlighted = highlightText(refText.value);
      // ë‹¨ìˆœ ë¯¸ë¦¬ë³´ê¸°ì²˜ëŸ¼ ì²˜ë¦¬ - ì•„ë˜ ë°”ë¡œ í‘œì‹œí•˜ì§„ ì•Šê³  ê·¸ëƒ¥ ë³µì‚¬í•  ë•Œ ì°¸ê³ ìš©
      // (ì›ë˜ textareaì—ëŠ” í•˜ì´ë¼ì´íŠ¸ ì ìš© ì–´ë ¤ì›Œì„œ ê·¸ëƒ¥ ë¯¸ë¦¬ë³´ê¸°ë¡œ ì¶”ê°€í•´ë„ ë¨)
    });

    // ë‚´ ê¸€ ì‘ì„±ì— ì…ë ¥ì‹œ ë¯¸ë¦¬ë³´ê¸°, í†µê³„ ë™ì‹œ ì—…ë°ì´íŠ¸
    myText.addEventListener('input', () => {
      updatePreview();
      updateStats();
    });

    // ê¸€ììˆ˜, ì¤„ìˆ˜, ë¶„ëŸ‰ í†µê³„
    function updateStats() {
      const text = myText.value.trim();
      const charCount = text.length;
      const lineCount = text.split('\n').length;
      const wordCount = text.split(/\s+/).filter(Boolean).length;
      const stats = `ê¸€ììˆ˜: ${charCount}ì / ì¤„ìˆ˜: ${lineCount}ì¤„ / ë‹¨ì–´ìˆ˜: ${wordCount}ê°œ`;
      document.getElementById('stats').innerText = stats;
    }

    // ë²„ì „ ì €ì¥ & ê´€ë¦¬
    const STORAGE_KEY = 'rp_versions';

    function saveVersion() {
      let content = myText.value.trim();
      if (!content) {
        alert('ë‚´ìš©ì´ ë¹„ì–´ìˆìœ¼ë©´ ì €ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      let versions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

      const timestamp = new Date().toLocaleString();
      versions.unshift({time: timestamp, text: content});
      if (versions.length > 20) versions.pop(); // ìµœëŒ€ 20ê°œ ë²„ì „ ìœ ì§€

      localStorage.setItem(STORAGE_KEY, JSON.stringify(versions));
      renderVersionList();
      alert(`ë²„ì „ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤ (${timestamp})`);
    }

    // ë²„ì „ ëª©ë¡ ë Œë”ë§
    function renderVersionList() {
      let versions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      versionList.innerHTML = '';
      if(versions.length === 0) {
        versionList.innerHTML = '<em>ì €ì¥ëœ ë²„ì „ì´ ì—†ìŠµë‹ˆë‹¤.</em>';
        return;
      }
      versions.forEach((v, idx) => {
        const div = document.createElement('div');
        div.className = 'version-item';
        div.innerHTML = `<span>${v.time}</span>
          <button title="ì‚­ì œ" aria-label="ë²„ì „ ì‚­ì œ" onclick="deleteVersion(${idx})">Ã—</button>
        `;
        div.style.cursor = 'pointer';
        div.onclick = () => {
          if(confirm('ì´ ë²„ì „ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì€ ì‚¬ë¼ì§‘ë‹ˆë‹¤.')) {
            myText.value = versions[idx].text;
            updatePreview();
            updateStats();
          }
        };
        versionList.appendChild(div);
      });
    }

    // ë²„ì „ ì‚­ì œ
    function deleteVersion(idx) {
      let versions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
      if (!confirm('ì´ ë²„ì „ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
      versions.splice(idx,1);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(versions));
      renderVersionList();
    }

    // ì´ˆê¸°í™”
    function clearText() {
      if(confirm('ëª¨ë“  ì‘ì„± ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        myText.value = '';
        updatePreview();
        updateStats();
      }
    }

    // í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°
    function downloadText() {
      const text = myText.value;
      if (!text.trim()) {
        alert('ë‚´ìš©ì´ ë¹„ì–´ìˆìœ¼ë©´ ë‚´ë³´ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      const blob = new Blob([text], {type: 'text/plain;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'my_rp_text.txt';
      a.click();
      URL.revokeObjectURL(url);
    }

    // ë„ì›€ë§ ì—´ê¸°/ë‹«ê¸°
    function openHelp() {
      document.getElementById('overlay').style.display = 'block';
      document.getElementById('helpModal').style.display = 'block';
    }
    function closeHelp() {
      document.getElementById('overlay').style.display = 'none';
      document.getElementById('helpModal').style.display = 'none';
    }

    // ì´ˆê¸° ë¡œë”© ì‹œ
    window.onload = () => {
      renderVersionList();
      updatePreview();
      updateStats();
    };
  </script>
</body>
</html>
